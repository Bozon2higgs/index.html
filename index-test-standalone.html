<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFH - Test Standalone</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        button {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-pdf {
            background: #e74c3c;
            color: white;
        }
        .btn-pdf:hover {
            background: #c0392b;
        }
        .btn-docx {
            background: #3498db;
            color: white;
        }
        .btn-docx:hover {
            background: #2980b9;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèõÔ∏è HFH - G√©n√©rateur de Documents</h1>
        
        <div id="status" class="status"></div>
        
        <div class="form-group">
            <label>Identit√©</label>
            <label><input type="radio" name="identite" value="identifie" checked> Identifi√©</label>
            <label><input type="radio" name="identite" value="anonyme"> Anonyme</label>
        </div>
        
        <div class="form-group">
            <label for="nom-prenom">Nom / Pr√©nom</label>
            <input type="text" id="nom-prenom" placeholder="Votre nom complet">
        </div>
        
        <div class="form-group">
            <label for="pays">Pays / Territoire concern√©</label>
            <input type="text" id="pays" placeholder="Ex: France">
        </div>
        
        <div class="form-group">
            <label for="date-debut">Date d√©but</label>
            <input type="date" id="date-debut">
        </div>
        
        <div class="form-group">
            <label for="date-fin">Date fin</label>
            <input type="date" id="date-fin">
        </div>
        
        <div class="form-group">
            <label for="victimes">Victimes / populations affect√©es</label>
            <input type="text" id="victimes" placeholder="Personnes concern√©es">
        </div>
        
        <div class="form-group">
            <label for="auteurs">Auteurs pr√©sum√©s</label>
            <input type="text" id="auteurs" placeholder="Si connus">
        </div>
        
        <div class="form-group">
            <label for="faits">Faits d√©taill√©s</label>
            <textarea id="faits" placeholder="Description chronologique des √©v√©nements..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="preuves">Preuves / annexes</label>
            <textarea id="preuves" placeholder="Liste des documents, t√©moignages..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="demandes">Demandes</label>
            <textarea id="demandes" placeholder="Ce que vous sollicitez..."></textarea>
        </div>
        
        

    <!-- Biblioth√®ques CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- JavaScript inline -->
    <script>
        console.log('‚úì Script charg√©');
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        function exportPDF() {
            console.log('‚Üí exportPDF appel√©');
            
            try {
                // V√©rifier jsPDF
                if (typeof window.jspdf === 'undefined' && typeof jsPDF === 'undefined') {
                    showStatus('‚ùå Erreur: jsPDF non charg√©', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf || window;
                
                // R√©cup√©rer les donn√©es
                const identite = document.querySelector('input[name="identite"]:checked').value;
                const nomPrenom = document.getElementById('nom-prenom').value;
                const pays = document.getElementById('pays').value;
                const dateDebut = document.getElementById('date-debut').value;
                const dateFin = document.getElementById('date-fin').value;
                const victimes = document.getElementById('victimes').value;
                const auteurs = document.getElementById('auteurs').value;
                const faits = document.getElementById('faits').value;
                const preuves = document.getElementById('preuves').value;
                const demandes = document.getElementById('demandes').value;
                
                // Cr√©er le PDF
                const doc = new jsPDF();
                let y = 20;
                const lineHeight = 7;
                const margin = 20;
                const maxWidth = 170;
                
                // Titre
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('SIGNALEMENT HFH', margin, y);
                y += lineHeight * 2;
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Document g√©n√©r√© localement - Confidentiel', margin, y);
                y += lineHeight * 2;
                
                // Fonction pour ajouter une section
                function addSection(title, content) {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text(title, margin, y);
                    y += lineHeight;
                    
                    if (content) {
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        const lines = doc.splitTextToSize(content, maxWidth);
                        lines.forEach(line => {
                            if (y > 280) {
                                doc.addPage();
                                y = 20;
                            }
                            doc.text(line, margin, y);
                            y += lineHeight;
                        });
                    }
                    y += lineHeight;
                }
                
                // Ajouter les sections
                if (identite === 'identifie' && nomPrenom) {
                    addSection('IDENTIT√â', nomPrenom);
                } else {
                    addSection('IDENTIT√â', 'Anonyme');
                }
                
                if (pays) addSection('PAYS/TERRITOIRE', pays);
                if (dateDebut) addSection('P√âRIODE - D√âBUT', dateDebut);
                if (dateFin) addSection('P√âRIODE - FIN', dateFin);
                if (victimes) addSection('VICTIMES', victimes);
                if (auteurs) addSection('AUTEURS PR√âSUM√âS', auteurs);
                if (faits) addSection('FAITS D√âTAILL√âS', faits);
                if (preuves) addSection('PREUVES', preuves);
                if (demandes) addSection('DEMANDES', demandes);
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(128);
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.text(
                        `HFH - Page ${i}/${pageCount} - ${new Date().toLocaleDateString()}`,
                        margin,
                        doc.internal.pageSize.getHeight() - 10
                    );
                }
                
                // T√©l√©charger
                const filename = `HFH_document_${Date.now()}.pdf`;
                doc.save(filename);
                
                showStatus('‚úì PDF g√©n√©r√© avec succ√®s !', 'success');
                console.log('‚úì PDF t√©l√©charg√©:', filename);
                
            } catch (error) {
                console.error('ERREUR PDF:', error);
                showStatus('‚ùå Erreur: ' + error.message, 'error');
            }
        }
        
        function exportDOCX() {
            console.log('‚Üí exportDOCX appel√©');
            
            try {
                // V√©rifier les biblioth√®ques
                if (typeof docx === 'undefined') {
                    showStatus('‚ùå Erreur: biblioth√®que docx non charg√©e', 'error');
                    return;
                }
                
                if (typeof saveAs === 'undefined') {
                    showStatus('‚ùå Erreur: biblioth√®que FileSaver non charg√©e', 'error');
                    return;
                }
                
                const { Document, Paragraph, HeadingLevel, AlignmentType, Packer } = docx;
                
                // R√©cup√©rer les donn√©es
                const identite = document.querySelector('input[name="identite"]:checked').value;
                const nomPrenom = document.getElementById('nom-prenom').value;
                const pays = document.getElementById('pays').value;
                const dateDebut = document.getElementById('date-debut').value;
                const dateFin = document.getElementById('date-fin').value;
                const victimes = document.getElementById('victimes').value;
                const auteurs = document.getElementById('auteurs').value;
                const faits = document.getElementById('faits').value;
                const preuves = document.getElementById('preuves').value;
                const demandes = document.getElementById('demandes').value;
                
                // Construire le document
                const sections = [];
                
                // En-t√™te
                sections.push(
                    new Paragraph({
                        text: 'SIGNALEMENT HFH',
                        heading: HeadingLevel.TITLE,
                        alignment: AlignmentType.CENTER,
                    }),
                    new Paragraph({ text: '' }),
                    new Paragraph({
                        text: 'Document g√©n√©r√© localement - Confidentiel',
                        alignment: AlignmentType.CENTER,
                        italics: true,
                    }),
                    new Paragraph({ text: '' })
                );
                
                // Fonction pour ajouter une section
                function addSection(title, content) {
                    if (content) {
                        sections.push(
                            new Paragraph({
                                text: title,
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({ text: content }),
                            new Paragraph({ text: '' })
                        );
                    }
                }
                
                // Ajouter les sections
                if (identite === 'identifie' && nomPrenom) {
                    addSection('IDENTIT√â', nomPrenom);
                } else {
                    addSection('IDENTIT√â', 'Anonyme');
                }
                
                if (pays) addSection('PAYS/TERRITOIRE', pays);
                if (dateDebut) addSection('P√âRIODE - D√âBUT', dateDebut);
                if (dateFin) addSection('P√âRIODE - FIN', dateFin);
                if (victimes) addSection('VICTIMES', victimes);
                if (auteurs) addSection('AUTEURS PR√âSUM√âS', auteurs);
                if (faits) addSection('FAITS D√âTAILL√âS', faits);
                if (preuves) addSection('PREUVES', preuves);
                if (demandes) addSection('DEMANDES', demandes);
                
                // Footer
                sections.push(
                    new Paragraph({ text: '' }),
                    new Paragraph({
                        text: `HFH - G√©n√©r√© le ${new Date().toLocaleString()}`,
                        alignment: AlignmentType.CENTER,
                        italics: true,
                    })
                );
                
                // Cr√©er le document
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: sections,
                    }],
                });
                
                // G√©n√©rer et t√©l√©charger
                Packer.toBlob(doc).then(blob => {
                    const filename = `HFH_document_${Date.now()}.docx`;
                    saveAs(blob, filename);
                    showStatus('‚úì DOCX g√©n√©r√© avec succ√®s !', 'success');
                    console.log('‚úì DOCX t√©l√©charg√©:', filename);
                }).catch(error => {
                    console.error('ERREUR DOCX:', error);
                    showStatus('‚ùå Erreur: ' + error.message, 'error');
                });
                
            } catch (error) {
                console.error('ERREUR DOCX:', error);
                showStatus('‚ùå Erreur: ' + error.message, 'error');
            }
        }
        
        // V√©rifier le chargement
        window.addEventListener('load', function() {
            console.log('=== V√âRIFICATION DES BIBLIOTH√àQUES ===');
            
            setTimeout(() => {
                let allGood = true;
                
                if (typeof window.jspdf !== 'undefined' || typeof jsPDF !== 'undefined') {
                    console.log('‚úì jsPDF charg√©');
                } else {
                    console.error('‚úó jsPDF non charg√©');
                    allGood = false;
                }
                
                if (typeof docx !== 'undefined') {
                    console.log('‚úì docx charg√©');
                } else {
                    console.error('‚úó docx non charg√©');
                    allGood = false;
                }
                
                if (typeof saveAs !== 'undefined') {
                    console.log('‚úì FileSaver charg√©');
                } else {
                    console.error('‚úó FileSaver non charg√©');
                    allGood = false;
                }
                
                if (typeof exportPDF === 'function') {
                    console.log('‚úì exportPDF disponible');
                } else {
                    console.error('‚úó exportPDF non disponible');
                    allGood = false;
                }
                
                if (typeof exportDOCX === 'function') {
                    console.log('‚úì exportDOCX disponible');
                } else {
                    console.error('‚úó exportDOCX non disponible');
                    allGood = false;
                }
                
                if (allGood) {
                    console.log('‚úì‚úì‚úì SYST√àME PR√äT ‚úì‚úì‚úì');
                    showStatus('‚úì Syst√®me op√©rationnel - vous pouvez exporter vos documents', 'success');
                } else {
                    showStatus('‚ö† Probl√®me de chargement - v√©rifiez la console (F12)', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>
